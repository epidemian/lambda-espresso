(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){},{}],2:[function(require,module,exports){var process=module.exports={};var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=setTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run()}}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;clearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){setTimeout(drainQueue,0)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},{}],3:[function(require,module,exports){module.exports=[{name:"Basics",code:"; This example is not intend to be a tutorial nor an introduction to λ Calculus.\n; You should check http://en.wikipedia.org/wiki/Lambda_calculus for that :)\n; As you can see, these are comments. You can run this example clicking the Run\n; button below or pressing Ctrl+Enter.\n; So, the three basic types of λ expressions are:\n; Variables:\nx\n; Applications:\nx y\n; And lambda abstractions (also known as functions):\nλx.x\n; If the left-side of an application is an abstraction, then a reduction takes place:\n(λx.x) y\n; That little abstraction at the left is the identity, a very simple function that\n; just reduces to whatever you apply to it. We can give it a name like so:\nid = λx.x\n; And then just refer it by that name:\nid a\n; You can apply any kind of λ expression to an abstraction, like another function:\nid λb.c\n; Or an application:\nid (x y)\n; Or even the identity function itself:\nid id\n; That means you can apply identity to itself as many times as you want and it'll still\n; be identity:\nid id id id id\n; Notice that applications are left-associative, so the line above is equivalent to:\n((((id id) id) id) id)\n\n; TODO: explain applicative and normal order..."},{name:"Booleans",code:'; Church booleans\n\n; The booleans and their operations can be encoded as the following λ-terms:\ntrue = λt.λf.t\nfalse = λt.λf.f\nnot = λp.p false true\nand = λp.λq.p q p\nor = λp.λq.p p q\nif = λp.p\n\n; Print truth tables for not, and and or:\nnot true\nnot false\nand false false\nand false true\nand true false\nand true true\nor false false\nor false true\nor true false\nor true true\n\n; Terms can be nested as much as we want:\nif (not not false) (or false (if true true false)) false\n\n; There\'s nothing special about "operators", we can treat them as any other value:\n(if false or and) true false'},{name:"Numbers",code:"; Church numerals\n\n; The first few numbers are:\nzero = λs.λz.z\none = λs.λz.s z\ntwo = λs.λz.s (s z)\nthree = λs.λz.s (s (s z))\n; In general, any natural number n can be encoded as:\n; N = λs.λz.s (s (s ... (s (s z)) ... ))\n; with s applied n times.\n\n; When we get tired of writing numbers like that, we can define a successor function:\nsucc = λn.λs.λz.s (n s z)\nsucc three\n\n; We can think of Church numerals as functions that apply a given function s to a\n; given value z a number of times. Zero will apply it 0 times (i.e. it'll give\n; us z back untouched) and three will call it 3 times.\n; So, we can represent the addition of numbers m and n as first applying n times s to z,\n; and then applying m times s to that:\nadd = λm.λn.λs.λz.m s (n s z)\nadd two three\n; ...or, more succinctly, as applying n times the successor function on m (or vice versa):\nadd' = λm.λn.n succ m\nadd' two three\n; Conversely, we could define the successor function as adding one:\nsucc' = add one\nsucc' three\n\n; Multiplication of m by n is applying m times a function that applies s n times:\nmult = λm.λn.λs.m (n s)\nmult three three\n; ...or applying m times the addition of n to zero:\nmult' = λm.λn.m (add n) zero\nmult' three three\n\n; Exponentiation n^m has a simple encoding: applying the base m to the exponent n,\n; which can be understood as applying m successively n times:\nexp = λm.λn.n m\nexp two three\n; ...or, alternatively, applying m times the multiplication by n to one:\nexp' = λm.λn.m (mult n) one\nexp' two three\n\n; The encoding for the predecessor function is quite complex.\n; The Wikipedia article on Church encoding has a good explanation for this term ;-)\npred = λn.λs.λz.n (λf.λg.g (f s)) (λx.z) (λx.x)\npred three\n\n; But given the predecessor function is then easy to define the subtraction:\nsub = λm.λn.n pred m\nsub three two\n\n; To build some predicate functions, we'll use some known boolean terms:\ntrue = λt.λf.t\nfalse = λt.λf.f\nand = λp.λq.p q p\n\n; To know if a number n is zero we can pass true as the base value and a function\n; that always returns false:\nzero? = λn.n (λx.false) true\nzero? zero\nzero? two\n\n; Given the \"= 0\" predicate, numeric equality between m and n can be defined as\n; m - n = 0 and n - m = 0\neq = λm.λn.and (zero? (sub m n)) (zero? (sub n m))\n\n; Throw everyting into the mix:\neq (exp two three) (pred (exp three two))"},{name:"Factorial",code:"; Recursion\n\n; Borrow some terms from previous examples:\ntrue = λt.λf.t\nfalse = λt.λf.f\nif = λp.p\n\nzero = λs.λz.z\none = λs.λz.s z\ntwo = λs.λz.s (s z)\nthree = λs.λz.s (s (s z))\nfour = λs.λz.s (s (s (s z)))\n\npred = λn.λs.λz.n (λf.λg.g (f s)) (λx.z) (λx.x)\nmult = λm.λn.λs.m (n s)\nzero? = λn.n (λx.false) true\n\n; We'd like to be able to define a factorial function as:\n; fact = λn.if (zero? n) one (mult n (fact (pred n)))\n; But we can't use a term in its own definition.\n; To achieve recursion, we can instead define a function that will receive itself\n; as a parameter r, and then recur by calling r with itself and n - 1:\nfact-rec = λr.λn.if (zero? n) one (mult n (r r (pred n)))\n; The real factorial function would then be:\nfact = fact-rec fact-rec\nfact four\n\n; Another way to recur is to use a general purpose fixed-point combinator.\n; The almighty Y Combinator:\nY = λf.(λx.f (x x)) (λx.f (x x))\n\n; And then there's no need to define a separate function:\nfact' = Y λr.λn.if (zero? n) one (mult n (r (pred n)))\nfact' four"}]},{}],4:[function(require,module,exports){(function(process){var grammar=function(){var o=function(k,v,o,l){for(o=o||{},l=k.length;l--;o[k[l]]=v);return o},$V0=[5,7],$V1=[1,6],$V2=[1,7],$V3=[1,8],$V4=[2,10],$V5=[5,7,11,13,14,15];var parser={trace:function trace(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,line:6,SEPARATOR:7,term:8,ident:9,"=":10,LAMBDA:11,".":12,"(":13,")":14,IDENT:15,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",7:"SEPARATOR",10:"=",11:"LAMBDA",12:".",13:"(",14:")",15:"IDENT"},productions_:[0,[3,2],[4,0],[4,1],[4,2],[4,3],[6,1],[6,3],[8,4],[8,2],[8,1],[8,3],[9,1]],performAction:function anonymous(yytext,yyleng,yylineno,yy,yystate,$$,_$){var $0=$$.length-1;switch(yystate){case 1:break;case 6:this.$=yy.parseTopLevelTerm($$[$0]);break;case 7:this.$=yy.parseDefinition($$[$0-2],$$[$0]);break;case 8:this.$=yy.parseFunction($$[$0-2],$$[$0]);break;case 9:this.$=yy.parseApplication($$[$0-1],$$[$0]);break;case 10:this.$=yy.parseIdentifier($$[$0]);break;case 11:this.$=$$[$0-1];break;case 12:this.$=yytext;break}},table:[o($V0,[2,2],{3:1,4:2,6:3,8:4,9:5,11:$V1,13:$V2,15:$V3}),{1:[3]},{5:[1,9],7:[1,10]},o($V0,[2,3]),o($V0,[2,6],{8:11,9:12,11:$V1,13:$V2,15:$V3}),o([5,7,11,13,15],$V4,{10:[1,13]}),{9:14,15:$V3},{8:15,9:12,11:$V1,13:$V2,15:$V3},o([5,7,10,11,12,13,14,15],[2,12]),{1:[2,1]},o($V0,[2,4],{8:4,9:5,6:16,11:$V1,13:$V2,15:$V3}),o($V5,[2,9],{8:11,9:12}),o($V5,$V4),{8:17,9:12,11:$V1,13:$V2,15:$V3},{12:[1,18]},{8:11,9:12,11:$V1,13:$V2,14:[1,19],15:$V3},o($V0,[2,5]),o($V0,[2,7],{8:11,9:12,11:$V1,13:$V2,15:$V3}),{8:20,9:12,11:$V1,13:$V2,15:$V3},o($V5,[2,11]),o([5,7,14],[2,8],{8:11,9:12,11:$V1,13:$V2,15:$V3})],defaultActions:{9:[2,1]},parseError:function parseError(str,hash){if(hash.recoverable){this.trace(str)}else{function _parseError(msg,hash){this.message=msg;this.hash=hash}_parseError.prototype=Error;throw new _parseError(str,hash)}},parse:function parse(input){var self=this,stack=[0],tstack=[],vstack=[null],lstack=[],table=this.table,yytext="",yylineno=0,yyleng=0,recovering=0,TERROR=2,EOF=1;var args=lstack.slice.call(arguments,1);var lexer=Object.create(this.lexer);var sharedState={yy:{}};for(var k in this.yy){if(Object.prototype.hasOwnProperty.call(this.yy,k)){sharedState.yy[k]=this.yy[k]}}lexer.setInput(input,sharedState.yy);sharedState.yy.lexer=lexer;sharedState.yy.parser=this;if(typeof lexer.yylloc=="undefined"){lexer.yylloc={}}var yyloc=lexer.yylloc;lstack.push(yyloc);var ranges=lexer.options&&lexer.options.ranges;if(typeof sharedState.yy.parseError==="function"){this.parseError=sharedState.yy.parseError}else{this.parseError=Object.getPrototypeOf(this).parseError}function popStack(n){stack.length=stack.length-2*n;vstack.length=vstack.length-n;lstack.length=lstack.length-n}_token_stack:var lex=function(){var token;token=lexer.lex()||EOF;if(typeof token!=="number"){token=self.symbols_[token]||token}return token};var symbol,preErrorSymbol,state,action,a,r,yyval={},p,len,newState,expected;while(true){state=stack[stack.length-1];if(this.defaultActions[state]){action=this.defaultActions[state]}else{if(symbol===null||typeof symbol=="undefined"){symbol=lex()}action=table[state]&&table[state][symbol]}if(typeof action==="undefined"||!action.length||!action[0]){var errStr="";expected=[];for(p in table[state]){if(this.terminals_[p]&&p>TERROR){expected.push("'"+this.terminals_[p]+"'")}}if(lexer.showPosition){errStr="Parse error on line "+(yylineno+1)+":\n"+lexer.showPosition()+"\nExpecting "+expected.join(", ")+", got '"+(this.terminals_[symbol]||symbol)+"'"}else{errStr="Parse error on line "+(yylineno+1)+": Unexpected "+(symbol==EOF?"end of input":"'"+(this.terminals_[symbol]||symbol)+"'")}this.parseError(errStr,{text:lexer.match,token:this.terminals_[symbol]||symbol,line:lexer.yylineno,loc:yyloc,expected:expected})}if(action[0]instanceof Array&&action.length>1){throw new Error("Parse Error: multiple actions possible at state: "+state+", token: "+symbol)}switch(action[0]){case 1:stack.push(symbol);vstack.push(lexer.yytext);lstack.push(lexer.yylloc);stack.push(action[1]);symbol=null;if(!preErrorSymbol){yyleng=lexer.yyleng;yytext=lexer.yytext;yylineno=lexer.yylineno;yyloc=lexer.yylloc;if(recovering>0){recovering--}}else{symbol=preErrorSymbol;preErrorSymbol=null}break;case 2:len=this.productions_[action[1]][1];yyval.$=vstack[vstack.length-len];yyval._$={first_line:lstack[lstack.length-(len||1)].first_line,last_line:lstack[lstack.length-1].last_line,first_column:lstack[lstack.length-(len||1)].first_column,last_column:lstack[lstack.length-1].last_column};if(ranges){yyval._$.range=[lstack[lstack.length-(len||1)].range[0],lstack[lstack.length-1].range[1]]}r=this.performAction.apply(yyval,[yytext,yyleng,yylineno,sharedState.yy,action[1],vstack,lstack].concat(args));if(typeof r!=="undefined"){return r}if(len){stack=stack.slice(0,-1*len*2);vstack=vstack.slice(0,-1*len);lstack=lstack.slice(0,-1*len)}stack.push(this.productions_[action[1]][0]);vstack.push(yyval.$);lstack.push(yyval._$);newState=table[stack[stack.length-2]][stack[stack.length-1]];stack.push(newState);break;case 3:return true}}return true}};var lexer=function(){var lexer={EOF:1,parseError:function parseError(str,hash){if(this.yy.parser){this.yy.parser.parseError(str,hash)}else{throw new Error(str)}},setInput:function(input,yy){this.yy=yy||this.yy||{};this._input=input;this._more=this._backtrack=this.done=false;this.yylineno=this.yyleng=0;this.yytext=this.matched=this.match="";this.conditionStack=["INITIAL"];this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0};if(this.options.ranges){this.yylloc.range=[0,0]}this.offset=0;return this},input:function(){var ch=this._input[0];this.yytext+=ch;this.yyleng++;this.offset++;this.match+=ch;this.matched+=ch;var lines=ch.match(/(?:\r\n?|\n).*/g);if(lines){this.yylineno++;this.yylloc.last_line++}else{this.yylloc.last_column++}if(this.options.ranges){this.yylloc.range[1]++}this._input=this._input.slice(1);return ch},unput:function(ch){var len=ch.length;var lines=ch.split(/(?:\r\n?|\n)/g);this._input=ch+this._input;this.yytext=this.yytext.substr(0,this.yytext.length-len);this.offset-=len;var oldLines=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1);this.matched=this.matched.substr(0,this.matched.length-1);if(lines.length-1){this.yylineno-=lines.length-1}var r=this.yylloc.range;this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:lines?(lines.length===oldLines.length?this.yylloc.first_column:0)+oldLines[oldLines.length-lines.length].length-lines[0].length:this.yylloc.first_column-len};if(this.options.ranges){this.yylloc.range=[r[0],r[0]+this.yyleng-len]}this.yyleng=this.yytext.length;return this},more:function(){this._more=true;return this},reject:function(){if(this.options.backtrack_lexer){this._backtrack=true}else{return this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})}return this},less:function(n){this.unput(this.match.slice(n))},pastInput:function(){var past=this.matched.substr(0,this.matched.length-this.match.length);return(past.length>20?"...":"")+past.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var next=this.match;if(next.length<20){next+=this._input.substr(0,20-next.length)}return(next.substr(0,20)+(next.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var pre=this.pastInput();var c=new Array(pre.length+1).join("-");return pre+this.upcomingInput()+"\n"+c+"^"},test_match:function(match,indexed_rule){var token,lines,backup;if(this.options.backtrack_lexer){backup={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done};if(this.options.ranges){backup.yylloc.range=this.yylloc.range.slice(0)}}lines=match[0].match(/(?:\r\n?|\n).*/g);if(lines){this.yylineno+=lines.length}this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:lines?lines[lines.length-1].length-lines[lines.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+match[0].length};this.yytext+=match[0];this.match+=match[0];this.matches=match;this.yyleng=this.yytext.length;if(this.options.ranges){this.yylloc.range=[this.offset,this.offset+=this.yyleng]}this._more=false;this._backtrack=false;this._input=this._input.slice(match[0].length);this.matched+=match[0];token=this.performAction.call(this,this.yy,this,indexed_rule,this.conditionStack[this.conditionStack.length-1]);if(this.done&&this._input){this.done=false}if(token){return token}else if(this._backtrack){for(var k in backup){this[k]=backup[k]}return false}return false},next:function(){if(this.done){return this.EOF}if(!this._input){this.done=true}var token,match,tempMatch,index;if(!this._more){this.yytext="";this.match=""}var rules=this._currentRules();for(var i=0;i<rules.length;i++){tempMatch=this._input.match(this.rules[rules[i]]);if(tempMatch&&(!match||tempMatch[0].length>match[0].length)){match=tempMatch;index=i;if(this.options.backtrack_lexer){token=this.test_match(tempMatch,rules[i]);if(token!==false){return token}else if(this._backtrack){match=false;continue}else{return false}}else if(!this.options.flex){break}}}if(match){token=this.test_match(match,rules[index]);if(token!==false){return token}return false}if(this._input===""){return this.EOF}else{return this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})}},lex:function lex(){var r=this.next();if(r){return r}else{return this.lex()}},begin:function begin(condition){this.conditionStack.push(condition)},popState:function popState(){var n=this.conditionStack.length-1;if(n>0){return this.conditionStack.pop()}else{return this.conditionStack[0]}},_currentRules:function _currentRules(){if(this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules}else{return this.conditions["INITIAL"].rules}},topState:function topState(n){n=this.conditionStack.length-1-Math.abs(n||0);if(n>=0){return this.conditionStack[n]}else{return"INITIAL"}},pushState:function pushState(condition){this.begin(condition)},stateStackSize:function stateStackSize(){return this.conditionStack.length},options:{},performAction:function anonymous(yy,yy_,$avoiding_name_collisions,YY_START){var YYSTATE=YY_START;switch($avoiding_name_collisions){case 0:return 13;break;case 1:return 14;break;case 2:return 11;break;case 3:return 12;break;case 4:return 10;break;case 5:return 7;break;case 6:break;case 7:break;case 8:return 15;break;case 9:return 5;break}},rules:[/^(?:\()/,/^(?:\))/,/^(?:\\|λ)/,/^(?:\.)/,/^(?:=)/,/^(?:[\n])/,/^(?:\s+)/,/^(?:;.*)/,/^(?:[^\s\(\)\\λ\.=]+)/,/^(?:$)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9],inclusive:true}}};return lexer}();parser.lexer=lexer;function Parser(){this.yy={}}Parser.prototype=parser;parser.Parser=Parser;return new Parser}();if(typeof require!=="undefined"&&typeof exports!=="undefined"){exports.parser=grammar;exports.Parser=grammar.Parser;exports.parse=function(){return grammar.parse.apply(grammar,arguments)};exports.main=function commonjsMain(args){if(!args[1]){console.log("Usage: "+args[0]+" FILE");process.exit(1)}var source=require("fs").readFileSync(require("path").normalize(args[1]),"utf8");return exports.parser.parse(source)};if(typeof module!=="undefined"&&require.main===module){exports.main(process.argv.slice(1))}}}).call(this,require("_process"))},{_process:2,fs:1,path:1}],5:[function(require,module,exports){var logTimings,slice=[].slice;exports.repeatStr=function(str,n){var res;res="";while(n--){res+=str}return res};exports.extend=function(){var i,k,len,obj,src,srcs,v;obj=arguments[0],srcs=2<=arguments.length?slice.call(arguments,1):[];for(i=0,len=srcs.length;i<len;i++){src=srcs[i];for(k in src){v=src[k];obj[k]=v}}return obj};logTimings=false;exports.timed=function(name,fn){return function(){var args,res;args=1<=arguments.length?slice.call(arguments,0):[];if(logTimings){console.time(name)}res=fn.apply(null,args);if(logTimings){console.timeEnd(name)}return res}};exports.enableLogTimings=function(){return logTimings=true};exports.disableLogTimings=function(){return logTimings=false};exports.compose=function(f,g){return function(x){return f(g(x))}};exports.identity=function(x){return x}},{}],6:[function(require,module,exports){var $,enableLogTimings,example,examples,examplesDropdown,examplesHtml,examplesMenu,getOptions,hash,i,input,output,reduceProgram,reductions,ref,renderArrow,renderArrowByType,renderCollapsedReduction,renderCollapsedReductionForm,renderExpandedReductionForm,renderReductions,renderStepOptions,renderSynonyms,renderTerm,run,timed,updateInputFromHash;reduceProgram=require("./lambda").reduceProgram;examples=require("./examples");ref=require("./helpers"),timed=ref.timed,enableLogTimings=ref.enableLogTimings;enableLogTimings();$=document.querySelector.bind(document);Node.prototype.on=Node.prototype.addEventListener;Node.prototype.delegate=function(eventType,selector,handler){return this.on(eventType,function(event){var element,results;element=event.target;results=[];while(element!==this){if(element.matches(selector)){handler.apply(element,arguments);break}results.push(element=element.parentNode)}return results})};Node.prototype.once=function(eventType,handler){var onceListener;onceListener=function(){handler.apply(this,arguments);return this.removeEventListener(eventType,onceListener)};return this.on(eventType,onceListener)};Node.prototype.index=function(){return Array.prototype.indexOf.call(this.parentNode.childNodes,this)};input=$(".input");output=$(".output");document.on("keyup",function(e){if(e.keyCode===13&&e.ctrlKey){return run()}});input.on("keyup",function(e){var code,end,start;code=input.value;code=code.replace(/\\/g,"λ");start=input.selectionStart;end=input.selectionEnd;input.value=code;input.selectionStart=start;return input.selectionEnd=end});$(".run").on("click",function(){return run()});renderTerm=function(term,className){if(className==null){className=""}return"<span class='term "+className+"'>"+term+"</span>"};renderArrow=function(symbol,label){return"<span class=arrow>"+symbol+"<small>"+label+"</small></span>"};renderArrowByType=function(type){var label,symbol;symbol=type==="def"?"≡":"→";label=function(){switch(type){case"alpha":return"α";case"beta":return"β";default:return""}}();return renderArrow(symbol,label)};renderSynonyms=function(synonyms){if(synonyms.length){return"<span class=synonyms>("+synonyms.join(", ")+")</span>"}else{return""}};getOptions=function(){var maxSteps,strategy;maxSteps=parseInt($("input[name=max-steps]").value||0);strategy=$("input[name=strategy]:checked").value;return{maxSteps:maxSteps,strategy:strategy}};reductions=null;run=function(){var err,error,program;program=input.value;try{reductions=reduceProgram(program,getOptions());renderReductions()}catch(error){err=error;output.textContent=err.message}return output.classList.toggle("error",err!=null)};renderReductions=timed("render html",function(){var html;html=reductions.map(renderCollapsedReduction).join("");return output.innerHTML=html});output.delegate("click",".reduction",function(){var collapsed,expanded,reduction;reduction=reductions[this.index()];if(reduction.totalSteps===0){return}expanded=this.querySelector(".expanded");collapsed=this.querySelector(".collapsed");if(expanded){expanded.classList.toggle("hidden");return collapsed.classList.toggle("hidden")}else{collapsed.classList.add("hidden");return this.innerHTML+=renderExpandedReductionForm(reduction)}});output.delegate("mouseover",".expanded .step",function(){var ref1;this.classList.add("highlight");return(ref1=this.previousElementSibling)!=null?ref1.querySelector(".after").classList.add("hidden"):void 0});output.delegate("mouseout",".expanded .step",function(){var ref1;this.classList.remove("highlight");return(ref1=this.previousElementSibling)!=null?ref1.querySelector(".after").classList.remove("hidden"):void 0});renderCollapsedReduction=function(reduction){return"<div class=reduction>"+renderCollapsedReductionForm(reduction)+"</div>"};renderCollapsedReductionForm=function(reduction){var arrow,arrowAndFinal,final,initial,synonyms;initial=renderTerm(reduction.initial);arrowAndFinal=reduction.totalSteps>0?(arrow=renderArrow("→","("+reduction.totalSteps+")"),final=renderTerm(reduction.final),arrow+" "+final):"";synonyms=renderSynonyms(reduction.finalSynonyms);return"<div class=collapsed>"+initial+" "+arrowAndFinal+" "+synonyms+"</div>"};renderExpandedReductionForm=function(reduction){var after,arrow,before,i,lastStep,step,steps,synonyms;steps=function(){var j,ref1,results;results=[];for(i=j=0,ref1=reduction.totalSteps;0<=ref1?j<ref1:j>ref1;i=0<=ref1?++j:--j){step=reduction.renderStep(i,renderStepOptions);before=renderTerm(step.before,"before");after=renderTerm(step.after,"after");arrow=renderArrowByType(step.type);lastStep=i===reduction.totalSteps-1;synonyms=lastStep?renderSynonyms(reduction.finalSynonyms):"";results.push("<span class=step>"+before+"<br>"+arrow+" "+after+" "+synonyms+"</span>")}return results}();return"<div class=expanded>"+steps.join("")+"</div>"};renderStepOptions={highlightStep:function(str){return"<span class=match>"+str+"</span>"},highlightFormerTerm:function(str){return"<span class=former-term>"+str+"</span>"},highlightSubstitutionTerm:function(str){return"<span class=subst-term>"+str+"</span>"}};input.value='; Write some λ-expressions here and hit Run. Use "\\" to enter "λ" ;)\n(λx.λy.λz.z y x) a b c';input.focus();examplesMenu=$(".examples-menu");examplesHtml=function(){var j,len,results;results=[];for(i=j=0,len=examples.length;j<len;i=++j){example=examples[i];hash=(">"+example.code).replace(/\n/g,"%0A");results.push("<li><a href='#"+hash+"'>"+i+" - "+example.name+"</a></li>")}return results}();examplesMenu.innerHTML=examplesHtml.join("");examplesMenu.delegate("click","li",function(e){e.preventDefault();return input.value=examples[this.index()].code});examplesDropdown=$(".examples-dropdown");examplesDropdown.on("click",function(e){if(examplesDropdown.classList.contains("active")){return}e.stopPropagation();examplesDropdown.classList.add("active");return document.once("click",function(){return examplesDropdown.classList.remove("active")})});$("button.link").on("click",function(){var code;code=input.value;return location.hash=">"+code});updateInputFromHash=function(){var code,codeStart;hash=decodeURI(location.hash);codeStart=hash.indexOf(">");if(codeStart!==-1){code=hash.slice(codeStart+1);return input.value=code}};window.addEventListener("hashchange",updateInputFromHash);updateInputFromHash()},{"./examples":3,"./helpers":5,"./lambda":7}],7:[function(require,module,exports){var App,Def,Fun,Ref,Var,alphaEq,apply,applySubstitution,checkForCircularRefs,compose,composeAbs,composeAppL,composeAppR,defaultOptions,expandStep,extend,find,findSynonyms,freeIn,highlight,highlightFunctionVar,identity,markStep,parse,reduceApplicative,reduceCallByName,reduceCallByValue,reduceFunctions,reduceNormal,reduceProgram,reduceTerm,ref,renameForSubstitution,renameVar,replace,resolveDefRefs,resolveReferences,resolveTermRefs,substitute,termStr,timed,varRenameCollides,indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i}return-1},slice=[].slice;ref=require("./helpers"),extend=ref.extend,timed=ref.timed,compose=ref.compose,identity=ref.identity;Var=function(name){return{type:Var,name:name}};Fun=function(param,body){return{type:Fun,param:param,body:body}};App=function(left,right){return{type:App,left:left,right:right}};Def=function(name,term){return{type:Def,name:name,term:term}};Ref=function(name){return{type:Ref,name:name}};parse=timed("parse",function(str){var defs,parser,terms;parser=new(require("./grammar").Parser);defs={};terms=[];parser.yy={parseFunction:Fun,parseApplication:App,parseDefinition:function(name,term){if(defs[name]){throw Error(name+" already defined")}return defs[name]=Def(name,term)},parseTopLevelTerm:function(term){return terms.push(term)},parseIdentifier:Ref};parser.parse(str);return resolveReferences(defs,terms)});resolveReferences=function(defs,terms){var def,defRefs,j,len,name,t;for(j=0,len=terms.length;j<len;j++){t=terms[j];resolveTermRefs(t,defs)}defRefs={};for(name in defs){def=defs[name];resolveDefRefs(name,def.term,defs,defRefs)}return{defs:defs,terms:terms}};resolveTermRefs=function(t,defs,boundNames){var free,ref1;if(boundNames==null){boundNames=[]}switch(t.type){case Ref:free=(ref1=t.name,indexOf.call(boundNames,ref1)<0);if(t.name in defs&&free){t.type=Def;t.term=defs[t.name].term}else{t.type=Var}break;case App:resolveTermRefs(t.left,defs,boundNames);resolveTermRefs(t.right,defs,boundNames);break;case Fun:resolveTermRefs(t.body,defs,boundNames.concat(t.param))}return void 0};resolveDefRefs=function(defName,t,defs,defRefs,boundNames){var bound,ref1;if(boundNames==null){boundNames=[]}switch(t.type){case Ref:bound=(ref1=t.name,indexOf.call(boundNames,ref1)>=0);if(bound){t.type=Var}else if(t.name in defs){(defRefs[defName]||(defRefs[defName]=[])).push(t.name);checkForCircularRefs(defName,t.name,defRefs);t.type=Def;t.term=defs[t.name].term}else{throw Error('Illegal free variable "'+t.name+'" in "'+defName+'". Definitions cannot have free variables')}break;case App:resolveDefRefs(defName,t.left,defs,defRefs,boundNames);resolveDefRefs(defName,t.right,defs,defRefs,boundNames);break;case Fun:resolveDefRefs(defName,t.body,defs,defRefs,boundNames.concat(t.param))}return void 0};checkForCircularRefs=function(name,refName,defRefs,path){var circularNote,j,len,message,nextRef,ref1,results;if(path==null){path=[]}if(name===refName){circularNote=path.length&&"In this case the definition does not reference itself directly, but through other definitions: "+[name].concat(slice.call(path),[name]).join(" → ")+". ";message='Illegal recursive reference in "'+name+'". Definitions cannot reference themselves; they are just simple find&replace mechanisms. '+(circularNote||"")+'If you want to write a recursive function, look for "Y combinator" ;)';throw Error(message)}ref1=defRefs[refName]||{};results=[];for(j=0,len=ref1.length;j<len;j++){nextRef=ref1[j];results.push(checkForCircularRefs(name,nextRef,defRefs,slice.call(path).concat([refName])))}return results};termStr=function(t,appParens,funParens){var lambda,str;if(appParens==null){appParens=false}if(funParens==null){funParens=false}str=function(){switch(t.type){case Var:case Def:return t.name;case Fun:lambda="λ"+t.param;if(t.highlightVar){lambda=t.highlightVar(lambda)}str=lambda+"."+termStr(t.body);if(funParens){return"("+str+")"}else{return str}break;case App:str=termStr(t.left,false,true)+" "+termStr(t.right,true,funParens);if(appParens){return"("+str+")"}else{return str}}}();if(t.highlight){str=t.highlight(str)}return str};highlight=function(t,fn){if(t.highlight){fn=compose(fn,t.highlight)}return extend({},t,{highlight:fn})};highlightFunctionVar=function(t,x,fn){var ht,hx;hx=highlight(Var(x),fn);ht=substitute(t,x,hx);return extend(Fun(x,ht),{highlightVar:fn})};composeAbs=function(fn,x){return function(b){return fn(Fun(x,b))}};composeAppL=function(fn,l){return function(r){return fn(App(l,r))}};composeAppR=function(fn,r){return function(l){return fn(App(l,r))}};reduceCallByName=function(t,cb){var l;switch(t.type){case Var:case Fun:return t;case App:l=reduceCallByName(t.left,composeAppR(cb,t.right));if(l.type===Fun){return reduceCallByName(apply(l,t.right,cb),cb)}else{return App(l,t.right)}break;case Def:cb(markStep("def",t,t.term));return reduceCallByName(t.term,cb)}};reduceNormal=function(t,cb){var l,r;switch(t.type){case Var:return t;case Fun:return Fun(t.param,reduceNormal(t.body,composeAbs(cb,t.param)));case App:l=reduceCallByName(t.left,composeAppR(cb,t.right));if(l.type===Fun){return reduceNormal(apply(l,t.right,cb),cb)}else{l=reduceNormal(l,composeAppR(cb,t.right));r=reduceNormal(t.right,composeAppL(cb,l));return App(l,r)}break;case Def:cb(markStep("def",t,t.term));return reduceNormal(t.term,cb)}};reduceCallByValue=function(t,cb){var l,r;switch(t.type){case Var:case Fun:
return t;case App:l=reduceCallByValue(t.left,composeAppR(cb,t.right));r=reduceCallByValue(t.right,composeAppL(cb,l));if(l.type===Fun){return reduceCallByValue(apply(l,r,cb),cb)}else{return App(l,r)}break;case Def:cb(markStep("def",t,t.term));return reduceCallByName(t.term,cb)}};reduceApplicative=function(t,cb){var l,r;switch(t.type){case Var:return t;case Fun:return Fun(t.param,reduceApplicative(t.body,composeAbs(cb,t.param)));case App:l=reduceCallByValue(t.left,composeAppR(cb,t.right));if(l.type===Fun){r=reduceCallByValue(t.right,composeAppL(cb,l));return reduceApplicative(apply(l,r,cb),cb)}else{l=reduceApplicative(l,composeAppR(cb,t.right));r=reduceApplicative(t.right,composeAppL(cb,l));return App(l,r)}break;case Def:cb(markStep("def",t,t.term));return reduceApplicative(t.term,cb)}};apply=function(fun,subst,cb){var applied,renameCb,renamed,renamedBody;renameCb=composeAbs(composeAppR(cb,subst),fun.param);renamedBody=renameForSubstitution(fun.body,fun.param,subst,renameCb);renamed=App(Fun(fun.param,renamedBody),subst);applied=applySubstitution(renamedBody,fun.param,subst);cb(markStep("beta",renamed,applied));return applied};substitute=function(t,x,s){var newVarName,renamedBody;switch(t.type){case Var:if(t.name===x){return s}else{return t}break;case Fun:if(t.param===x){return t}if(freeIn(t.param,s)&&freeIn(x,t.body)){newVarName=renameVar(t.param,t.body,s);renamedBody=applySubstitution(t.body,t.param,Var(newVarName));return Fun(newVarName,substitute(renamedBody,x,s))}else{return Fun(t.param,substitute(t.body,x,s))}break;case App:return App(substitute(t.left,x,s),substitute(t.right,x,s));case Def:return t}};renameForSubstitution=function(t,x,s,cb){var l,newVarName,r,renamedBody;switch(t.type){case Var:case Def:return t;case Fun:if(t.param===x){return t}if(freeIn(t.param,s)&&freeIn(x,t.body)){newVarName=renameVar(t.param,t.body,s);renamedBody=applySubstitution(t.body,t.param,Var(newVarName));cb(markStep("alpha",t,t=Fun(newVarName,renamedBody)))}return Fun(t.param,renameForSubstitution(t.body,x,s,composeAbs(cb,t.param)));case App:l=renameForSubstitution(t.left,x,s,composeAppR(cb,t.right));r=renameForSubstitution(t.right,x,s,composeAppL(cb,l));return App(l,r)}};applySubstitution=function(t,x,s){switch(t.type){case Var:if(t.name===x){return s}else{return t}break;case Fun:if(t.param===x){return t}else{return Fun(t.param,applySubstitution(t.body,x,s))}break;case App:return App(applySubstitution(t.left,x,s),applySubstitution(t.right,x,s));case Def:return t}};renameVar=function(oldName,t,s){var base,isValid,m,n,newName;base=oldName.replace(/\d+$/,"");n=(m=oldName.match(/\d+$/))?parseInt(m[0]):0;while(true){newName=base+ ++n;isValid=!freeIn(newName,s)&&!freeIn(newName,t)&&!varRenameCollides(t,oldName,newName);if(isValid){return newName}}};freeIn=function(x,t){switch(t.type){case Var:return t.name===x;case Fun:return t.param!==x&&freeIn(x,t.body);case App:return freeIn(x,t.left)||freeIn(x,t.right);case Def:return freeIn(x,t.term)}};varRenameCollides=function(t,oldName,newName){var collisionHere;switch(t.type){case Var:return false;case Fun:collisionHere=t.param===newName&&freeIn(oldName,t);return collisionHere||varRenameCollides(t.body,oldName,newName);case App:return varRenameCollides(t.left,oldName,newName)||varRenameCollides(t.right,oldName,newName);case Def:return varRenameCollides(t.term,oldName,newName)}};markStep=function(type,before,after){return extend({},after,{step:{type:type,before:before}})};find=function(t,fn){if(fn(t)){return t}switch(t.type){case Var:case Def:return null;case Fun:return find(t.body,fn);case App:return find(t.left,fn)||find(t.right,fn)}};replace=function(t,from,to){var body,l,r;if(t===from){return to}switch(t.type){case Var:case Def:return t;case Fun:body=replace(t.body,from,to);if(t.body===body){return t}else{return Fun(t.param,body)}break;case App:l=replace(t.left,from,to);if(t.left===l){r=replace(t.right,from,to);if(t.right===r){return t}else{return App(l,r)}}else{return App(l,t.right)}}};expandStep=function(t,options){var after,before,ha,highlightFormer,highlightStep,highlightSubst,hs,stepTerm,type;if(options==null){options={}}stepTerm=find(t,function(subT){return subT.step});type=stepTerm.step.type;before=stepTerm.step.before;after=stepTerm;highlightFormer=options.highlightFormerTerm||identity;highlightSubst=options.highlightSubstitutionTerm||identity;highlightStep=options.highlightStep||identity;switch(type){case"alpha":before=highlightFunctionVar(before.body,before.param,highlightFormer);after=highlightFunctionVar(after.body,after.param,highlightSubst);break;case"beta":hs=highlight(before.right,highlightSubst);ha=highlightFunctionVar(before.left.body,before.left.param,highlightFormer);before=App(ha,hs);after=substitute(before.left.body,before.left.param,hs);break;case"def":before=highlight(before,highlightFormer);after=highlight(after,highlightSubst)}before=highlight(before,highlightStep);after=highlight(after,highlightStep);before=termStr(replace(t,stepTerm,before));after=termStr(replace(t,stepTerm,after));return{type:type,before:before,after:after}};alphaEq=function(t1,t2){if(t1.type===Def){return alphaEq(t1.term,t2)}if(t2.type===Def){return alphaEq(t1,t2.term)}if(t1.type!==t2.type){return false}switch(t1.type){case Var:return t1.name===t2.name;case Fun:if(t1.param===t2.param){return alphaEq(t1.body,t2.body)}else{return alphaEq(t1.body,substitute(t2.body,t2.param,Var(t1.param)))}break;case App:return alphaEq(t1.left,t2.left)&&alphaEq(t1.right,t2.right)}};findSynonyms=function(term,defs){var def,name,results;results=[];for(name in defs){def=defs[name];if(alphaEq(term,def)){results.push(name)}}return results};defaultOptions={maxSteps:100,strategy:"normal"};reduceFunctions={normal:reduceNormal,applicative:reduceApplicative,cbn:reduceCallByName,cbv:reduceCallByValue};reduceTerm=timed("reduce",function(term,defs,options){var e,enough,error,final,finalSynonyms,initial,maxSteps,reduce,ref1,renderStep,steps,strategy,terminates,totalSteps;ref1=extend({},defaultOptions,options),maxSteps=ref1.maxSteps,strategy=ref1.strategy;reduce=reduceFunctions[strategy];enough={};steps=[];try{reduce(term,function(t){if(steps.length>=maxSteps){throw enough}return steps.push(t)});terminates=true}catch(error){e=error;if(e!==enough){throw e}terminates=false}initial=term;final=steps[steps.length-1]||term;finalSynonyms=findSynonyms(final,defs);initial=termStr(initial);final=termStr(final);totalSteps=steps.length;renderStep=function(i,options){return expandStep(steps[i],options)};return{initial:initial,"final":final,finalSynonyms:finalSynonyms,terminates:terminates,totalSteps:totalSteps,renderStep:renderStep}});reduceProgram=function(program,options){var defs,j,len,ref1,results,term,terms;if(options==null){options={}}ref1=parse(program),terms=ref1.terms,defs=ref1.defs;results=[];for(j=0,len=terms.length;j<len;j++){term=terms[j];results.push(reduceTerm(term,defs,options))}return results};module.exports={Var:Var,Fun:Fun,App:App,Def:Def,parse:parse,termStr:termStr,reduceProgram:reduceProgram}},{"./grammar":4,"./helpers":5}]},{},[6]);
//# sourceMappingURL=index.min.js.map
